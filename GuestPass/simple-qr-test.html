<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple QR Test</title>
    <script src="./qrcode.min.js"></script>
</head>
<body>
    <h1>Simple QR Code Test</h1>
    <div id="qrcode"></div>
    <div id="result"></div>

    <script>
        function testQR() {
            const container = document.getElementById('qrcode');
            const result = document.getElementById('result');
            
            try {
                console.log('Testing QRCode library...');
                console.log('QRCode available:', typeof QRCode);
                console.log('QRCode methods:', Object.keys(QRCode));
                
                // Test with a simple code
                const testCode = 'TEST123';
                
                // Create QR code
                const qrCode = new QRCode(container, {
                    text: testCode,
                    width: 200,
                    height: 200,
                    colorDark: '#000000',
                    colorLight: '#FFFFFF',
                    correctLevel: QRCode.CorrectLevel.M
                });
                
                console.log('QRCode created:', qrCode);
                
                // Check what was created
                setTimeout(() => {
                    const canvas = container.querySelector('canvas');
                    const img = container.querySelector('img');
                    
                    console.log('Canvas found:', !!canvas);
                    console.log('Image found:', !!img);
                    
                    if (canvas) {
                        console.log('Canvas dimensions:', canvas.width, 'x', canvas.height);
                        
                        // Test canvas content
                        const ctx = canvas.getContext('2d');
                        const imageData = ctx.getImageData(0, 0, 10, 10);
                        console.log('Canvas image data (first 10x10 pixels):', imageData.data.slice(0, 40));
                        
                        // Check if there are black pixels
                        let blackPixels = 0;
                        let whitePixels = 0;
                        for (let i = 0; i < imageData.data.length; i += 4) {
                            const r = imageData.data[i];
                            const g = imageData.data[i + 1];
                            const b = imageData.data[i + 2];
                            const a = imageData.data[i + 3];
                            
                            if (r === 0 && g === 0 && b === 0 && a === 255) blackPixels++;
                            if (r === 255 && g === 255 && b === 255 && a === 255) whitePixels++;
                        }
                        console.log('Black pixels in top-left 10x10:', blackPixels);
                        console.log('White pixels in top-left 10x10:', whitePixels);
                        
                        result.innerHTML = `
                            <h3>Test Results:</h3>
                            <p>Canvas created: ✅</p>
                            <p>Black pixels found: ${blackPixels}</p>
                            <p>White pixels found: ${whitePixels}</p>
                            <p>QR should be visible if black pixels > 0</p>
                        `;
                    } else if (img) {
                        console.log('Image src:', img.src);
                        result.innerHTML = `
                            <h3>Test Results:</h3>
                            <p>Image created: ✅</p>
                            <p>Image source: ${img.src.substring(0, 50)}...</p>
                        `;
                    } else {
                        console.log('No canvas or image found');
                        result.innerHTML = `
                            <h3>Test Results:</h3>
                            <p>No QR elements found: ❌</p>
                        `;
                    }
                }, 1000);
                
            } catch (error) {
                console.error('QR test error:', error);
                result.innerHTML = `
                    <h3>Test Results:</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }
        
        // Run test when page loads
        window.addEventListener('load', testQR);
    </script>
</body>
</html>